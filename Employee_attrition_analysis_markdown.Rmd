---
title: "Employee Attrition Analysis"
author: "Nabeel Ghalib"
date: "18-04-2024"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

### Project overview

This Data Analysis project aims to provide insights into Attrition of employees from XYZ company. By Analyzing various aspects of the data we can identify trends, make Data-driven recommendation to improve the company.


### Problem Statement

XYZ company which was established a few years back is facing around a 15% attrition rate for
a couple of years. And it's majorly affecting the company in many aspects. In order to
understand why employees are leaving the company and reduce the attrition rate XYZ
company has approached an HR analytics consultancy for analyzing the data they have. You
are playing the HR analyst role in this project and building a dashboard which can help the
organization in making data-driven decisions.


### ASK

The key business task is to identify the reason employees are leaving the company,  

1. Finding out total employees  
2. Calculating the attrition rate  
3. Finding out the reason for attrition  


### Data Preparation

The dataset used is provided by Unified Mentor Private Limited which was provided for my Data Analytics internship program.

Note - The XYZ is a fictional company.

### Tools Used

**RStudio** - Data cleaning, Analyzing, and Visualization  
**Tableau** - Data Visualization


# Installing required packages

```{r}

library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(janitor)
library(forcats) # to reorder by values, variables etc..
library(scales) # to use percent()

```

# Importing the dataset

Importing the dataset and storing it in a data frame

```{r}

employee_attrition_data = read.csv("F:/Rprojects/Rprojects/Projects to work/Employee Attrition data.csv")

```


# DATA CLEANING

### Finding null values and na values

```{r}

print(paste0("There are ",nrow(employee_attrition_data)," rows" ))

print(paste0("There are ",ncol(employee_attrition_data)," columns"))

print(paste0("There are ",n_distinct(employee_attrition_data)," distinct rows"))

print(paste0("There are ",sum(is.null(employee_attrition_data))," null values"))

print(paste0("There are ",sum(is.na(employee_attrition_data))," na values"))

print(paste0("There are ",sum(is.na(employee_attrition_data$EmployeeID))," na values in EmployeeID"))

```

### Removing na values

```{r}

employee_attrition_data = employee_attrition_data %>% 
  drop_na() 

```

### Checking Number of rows, columns and distinct values after removing na values

```{r}

print(paste0("There are ",nrow(employee_attrition_data)," rows"))

print(paste0("There are ",ncol(employee_attrition_data)," columns"))


print(paste0("There are ",n_distinct(employee_attrition_data)," distinct rows"))

n_distinct(employee_attrition_data$BusinessTravel)

n_distinct(employee_attrition_data$Attrition)

n_distinct(employee_attrition_data$JobRole)

n_distinct(employee_attrition_data$Gender)

n_distinct(employee_attrition_data$JobLevel)

```

#### the data is cleaned and ready for analysis.

# DATA ANALYSIS

### Total Employees

```{r}

total_employees = employee_attrition_data %>% 
  select(EmployeeCount) %>% 
  summarise(total_employees = sum(EmployeeCount))

print(paste0("There are ",total_employees," employees"))

```


### Employee Attrition Count and Attrition rate

```{r warning=FALSE}

emp_att_count2 = employee_attrition_data %>% 
  select(Attrition) %>% 
  count(Attrition, name = 'total_employees') %>% 
  summarise(Attrition, total_employees, attrition_rate = round(total_employees/sum(total_employees)* 100, 2))

emp_att_count2

```
#### The attrition count is **695** and the attrition rate is **16.16%**


### Active Employee

```{r}

 active_employee = emp_att_count2 %>% 
  select(Attrition, total_employees) %>% 
  filter(Attrition == "No")

print(paste0('There are : ',active_employee$total_employees ,' active employees'))

```


### Attrition rate pie chart

```{r}
# pie chart attrition rate
# calculation to label the values in their respective positions

empatt_count_pie = emp_att_count2

empatt_count_pie = empatt_count_pie %>% 
  arrange(desc(Attrition)) %>% 
  mutate(prop = (total_employees / sum(empatt_count_pie$total_employees)))%>% 
  mutate(ypos = cumsum(prop)- 0.5 * prop)

empatt_count_pie


ggplot(empatt_count_pie, aes(x="", y = prop , fill= Attrition)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  labs(title = 'Employee Attrtion rate') +
  theme_void() + # remove background, grid, numeric labels 
  geom_text(aes(y = ypos, label = percent(prop,accuracy = 0.01)), color = 'black',size = 6)+
  scale_fill_brewer(palette="Dark2")
```


### Avg age for employees

```{r}

employee_attrition_data %>% 
  select(Age) %>% 
  summarise(average_age=mean(Age))

```

### Average age for employees Attrition wise

```{r}

employee_attrition_data %>% 
  select(Attrition,Age) %>% 
  filter(Attrition == 'Yes') %>% 
  summarise(attrition_average_age = mean(Age))

```

### Total employees and Attrition count from each department

```{r include=FALSE}

dep_att = employee_attrition_data %>% 
  select(Attrition,Department) %>% 
  filter(Attrition=='Yes') %>% 
  count(Department, name = 'attrition_count') %>% 
  arrange(-attrition_count)

dep_att
  
```

```{r include=FALSE}

emp_dep = employee_attrition_data %>% 
  select(Department) %>% 
  count(Department , name = 'total_employees') %>% 
  arrange(-total_employees) 

emp_dep

```

```{r eval=FALSE, include=FALSE}
# grouped chart ex

library(ggplot2)
library(reshape
ggplot(melt(df,id.vars="months"),aes(x=months,y=value,fill=variable))+
  geom_bar(stat="identity",position="dodge")+
  theme_bw()+
  scale_fill_discrete(labels=c("Ratio 1","Ratio2"),name=NULL)

# And if you want it to look somewhat like your original you could do:

ggplot(melt(df,id.vars="months"),aes(x=months,y=value,fill=variable))+
  geom_bar(stat="identity",position="dodge")+
  theme_bw()+
  scale_fill_manual(labels=c("ratio 1","ratio2"),name=NULL,values = c("blue", "orange"))+
  ylab("Percentage %")+
  xlab("Months")
```

```{r eval=FALSE, include=FALSE}

ggplot(dept_att,aes(x= Department, y = total_employees, fill = attrition_count))+
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(labels = c("total_employees", "attrition_count"), name = NULL, values = c("blue", "orange"))
  



```

```{r eval=FALSE, include=FALSE}
#gapminder %>%
 # mutate(country = as.character(country),
         #continent = as.character(continent),
         #lifeExp = as.integer(lifeExp),
         #pop = as.double(pop),
         #gdpPercap = as.numeric(gdpPercap))


dept_att_pie %>% 
  mutate(proportion_of_attrition_new = as.double(proportion_of_attrition))
```

```{r fig.height= 6, fig.width= 10}
# merging emp_dep , dep_att by department

dept_att = merge(emp_dep,dep_att, by = c("Department","Department"))

dept_att = dept_att %>% 
  arrange(-attrition_count)

dept_att = dept_att %>% 
  select(Department,total_employees,attrition_count) %>% 
  mutate(attrition_rate = (attrition_count/total_employees)) %>% 
  mutate(proportion_of_attrition = (attrition_count/sum(attrition_count)))

dept_att


# Bar graph


ggplot(data = dept_att, aes(x=Department, y = total_employees, attrition_count, fill = - attrition_count)) + 
  geom_col(position = "dodge") + labs(title = " Total employees, Attrition count and Attrition rate for each Department", y= 'Employees') +
  geom_text(aes(label = percent(attrition_rate)), vjust = -0.2) 



# pie chart



dept_att_pie = dept_att

dept_att_pie = dept_att_pie %>% 
  arrange(-proportion_of_attrition) %>% 
  mutate(prop = attrition_count / sum(attrition_count)) %>% 
  mutate(ypos = cumsum(prop)- 0.5 * prop) 

dept_att_pie

ggplot(data = dept_att_pie, aes (x=" ", y = prop, fill = Department))+
  geom_bar(stat= "identity", width = 1) +
  coord_polar("y", start = 0) +
  labs(title = "Proportion of attrition from each department") +
  theme_void() +
  geom_text(aes(y = ypos, label = percent(prop, accuracy = 0.01)), color = "black", size = 5) 
  
  


```

-   Highest attrition count is from **Research & Development Department**, Out of 2807 employees 443 left **(63.74%)**

-   Highest attrition rate (%) is from **Human Resources Department**, Out of 186 employees 54 left **(29.03%)**

-   Highest proportion of attrition is 64% from **Research & Development Department**


```{r eval=FALSE, include=FALSE}
### Grouped bar chart example

#convert(chr(country))

 # library
library(ggplot2)
 
# create a dataset
specie <- c(rep("sorgho" , 3) , rep("poacee" , 3) , rep("banana" , 3) , rep("triticum" , 3) )
condition <- rep(c("normal" , "stress" , "Nitrogen") , 4)
value <- abs(rnorm(12 , 0 , 15))
data <- data.frame(specie,condition,value)
 
# Grouped
ggplot(data, aes(fill=condition, y=value, x=specie)) + 
    geom_bar(position="dodge", stat="identity")
```

### Employees average, max, and min age depatment wise

```{r}

employee_attrition_data %>% 
  select(Age,Department) %>% 
  group_by(Department) %>% 
  summarise(average_age=mean(Age),min_age=min(Age),max_age=max(Age)) 
  


```

### Education field wise total employees and attrition

```{r}

eduf_att_tot = employee_attrition_data %>% 
  select(EducationField,Attrition) %>%
  group_by(EducationField) %>% 
  count(Attrition, name ='attrition_count') %>% 
  reframe(EducationField,Attrition, attrition_count, total_employees=sum(attrition_count)) %>% 
  arrange(-total_employees,EducationField)

eduf_att_tot

```

```{r fig.height = 5, fig.width = 12}

# Horizontal bar chart for education field employee count

ggplot(data = eduf_att_tot,aes(x = reorder(EducationField, total_employees) ,y = total_employees, fill = EducationField))+
  geom_bar(stat = "identity") +
  coord_flip()+
  labs(title = " Employee count Education Field wise", x= 'Education Field', y = 'Employee Count')+
  geom_text(aes(label = total_employees), hjust = -0.2) 



```

### Total employees and attrition count Business Travel wise

```{r}

bus_emp = employee_attrition_data %>% 
  select(BusinessTravel) %>% 
  count(BusinessTravel, name = 'total_employees')



bus_att = employee_attrition_data %>% 
  select(BusinessTravel, Attrition) %>% 
  filter(Attrition == "Yes") %>% 
  group_by(BusinessTravel) %>% 
  count(Attrition, name = 'attrition_count') %>% 
  summarise(BusinessTravel, attrition_count) 

# merging df's with businesstravel wise employees and attrition count into another df

bus_emp_att = merge(bus_emp,bus_att, by = "BusinessTravel")

bus_emp_att  = 
  bus_emp_att %>% 
  mutate(attrition_rate = percent(attrition_count/total_employees)) %>% 
  mutate(percent(attrition_count/sum(attrition_count)))

bus_emp_att




```

```{r}

bus_emp_att %>% 
  mutate(attrition_rate = percent(attrition_count/total_employees)) %>% 
  mutate(percent(attrition_count/sum(attrition_count)))

```

```{r include=FALSE}

### Total employee count and Attrition count Gender wise

#emp_att_count2 = employee_attrition_data %>% 
 # select(Attrition) %>% 
  #count(Attrition, name = 'total_employees') %>% 
  #summarise(Attrition, total_employees, attrition_rate = round(total_employees/sum(total_employees)* 100, 2))

gend_att = employee_attrition_data %>% 
  select(Gender, Attrition) %>% 
  filter(Attrition == 'Yes') %>% 
  count(Gender, name = 'attrition_count') %>% 
  summarise(Gender, attrition_count, attrition_rate = round(attrition_count/sum(attrition_count)*100, 2))
  
gend_att



#dept_att = merge(emp_dep,dep_att, by = c("Department","Department"))




```

```{r include=FALSE}


### Employee Count male and female wise

gend_tot = employee_attrition_data %>% 
  select(Gender) %>% 
  count(Gender, name = 'total_employees') 

gend_tot
  
```

### Employee count and attrition count Gender wise

```{r}

gend_tot_att = merge(gend_tot,gend_att, by = c("Gender","Gender"))

gend_tot_att


gend_pie = gend_tot_att

gend_pie = gend_pie %>% 
  arrange(-attrition_rate) %>% 
  mutate(prop = (attrition_count/sum(attrition_count))) %>% 
  mutate(ypos= cumsum(prop) - 0.5 * prop)

gend_pie

ggplot( data = gend_pie , aes(x= "", y = prop, fill = Gender)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  labs(title = 'Gender wise Attrtion rate') +
  theme_void() + # remove background, grid, numeric labels 
  geom_text(aes(y = ypos, label = percent(prop, accuracy = 0.01)), color = 'black',size = 6)
  


```

```{r eval=FALSE, include=FALSE}
### Employee attrition count gender wise

gender_att = employee_attrition_data %>% 
  select(Gender,Attrition) %>% 
  group_by(Gender) %>% 
  filter(Attrition == 'Yes') %>% 
  count(Attrition, name= 'attrition_count') %>% 
  summarise(Gender,Attrition, attrition_count)

gender_att

gender_att_pie = gender_att %>% 
  arrange(desc(Attrition)) %>% 
  mutate(prop = (attrition_count/ sum(attrition_count))) %>% 
  mutate(ypos = cumsum(prop)- 0.5  * prop)

gender_att_pie

ggplot(data = gender_att_pie, aes(x= "", y = prop, fill = Gender)) + 
  geom_bar(stat = "identity" , width = 1) +
  coord_polar("y", start = 0) +
  labs(title = 'Gender wise Attrtion rate') +
  theme_void() +  # remove background, grid, numeric labels 
  geom_text(aes(y = ypos, label = percent(prop)), color = 'black',size = 6)

```

```{r eval=FALSE, include=FALSE}
emp_att_count2 = employee_attrition_data %>% 
  select(Attrition,EmployeeCount) %>%
  group_by(Attrition) %>% 
  summarise(total_employees= sum(EmployeeCount))

emp_att_count2

```

```{r eval=FALSE, include=FALSE}
# Load ggplot2
library(ggplot2)
library(dplyr)

# Create Data
data <- data.frame(
  group=LETTERS[1:5],
  value=c(13,7,9,21,2)
)

# Compute the position of labels
data <- data %>% 
  arrange(desc(group)) %>%
  mutate(prop = value / sum(data$value) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )

# Basic piechart
ggplot(data, aes(x="", y=prop, fill=group)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() + 
  theme(legend.position="none") +
  
  geom_text(aes(y = ypos, label = group), color = "white", size=6) +
  scale_fill_brewer(palette="Set1")
```

### Attrition count for Environment Satisfaction

```{r}

en_sat = employee_attrition_data %>% 
  select(Attrition, EnvironmentSatisfaction) %>% 
  filter(Attrition == 'Yes') %>% 
  group_by(EnvironmentSatisfaction) %>% 
  count(Attrition, name = 'attrition_count') %>% 
  arrange(-attrition_count)

en_sat

  ggplot(data = en_sat, aes(x= EnvironmentSatisfaction, y = attrition_count, fill = - attrition_count)) + 
  geom_col(position = "dodge")+ 
  labs(title = " Attrition count Environment satisfaction wise", x= 'Environment satisfaction rating', y = 'Attrition Count')+
  geom_text(aes(label = attrition_count), vjust = -0.1) 
  
  
```

### Marital status wise employees and attrition rate

```{r}

mar_stat_tot = employee_attrition_data %>% 
  select(MaritalStatus) %>%
  count(MaritalStatus, name = "total_employees") 
mar_stat_tot

marstatfull = employee_attrition_data %>% 
  select(MaritalStatus, Attrition) %>% 
  filter(Attrition == "Yes") %>% 
  count(MaritalStatus,Attrition, name = "attrition_count") %>% 
  summarise(MaritalStatus, attrition_count, attrition_rate = percent(attrition_count/sum(attrition_count),accuracy = 0.01))

marstatfull

mar_stat_full = merge(mar_stat_tot,marstatfull, by = "MaritalStatus","MaritalStatus")

mar_stat_full

  
ggplot(data = mar_stat_full,aes(x=MaritalStatus , y = total_employees, fill = MaritalStatus)) +
  geom_col(position = "dodge",stat = "identity")+
  labs(title = "Marital Status wise employee count", x = "Marital Status", y = "Total Employees") +
  geom_text(aes(label = total_employees, vjust = -0.2)) 

mar_stat_full_pie = mar_stat_full

mar_stat_full_pie = mar_stat_full_pie %>% 
  arrange(-attrition_count) %>% 
  mutate(prop = (attrition_count/sum(attrition_count))) %>% 
  mutate(ypos = (cumsum(prop) - 0.5 * prop))

mar_stat_full_pie

ggplot(data = mar_stat_full_pie, aes(x="",y = prop , fill = MaritalStatus))+ 
  geom_bar(stat= "identity", width = 1)+
  coord_polar("y", start = 0)+
  labs(title = "Marital Status wise Attrition rate")+
  theme_void()+
  geom_text(aes(y = ypos  , label = percent(prop,accuracy = 0.01)), color = "Black",size = 5) +
  scale_fill_brewer(palette = "Dark2")

```

### Job Role

```{r fig.height= 8, fig.width = 15 }

# total employees

jr_emp = employee_attrition_data %>% 
  select(JobRole) %>% 
  count(JobRole, name = 'total_employees')

# attrition count

jr_att = employee_attrition_data %>% 
  select(JobRole, Attrition) %>% 
  filter(Attrition == 'Yes') %>% 
  count(JobRole, name = 'attrition_count') 

# merged 

jr_emp_att = merge(jr_emp, jr_att, by = "JobRole")

jr_emp_att = jr_emp_att %>% 
  select(JobRole,total_employees,attrition_count) %>% 
  mutate(attrition_rate = (attrition_count / total_employees)*100) %>% 
  mutate(prop_of_att= attrition_count / sum(attrition_count)* 100) %>% 
  arrange(- attrition_count)

jr_emp_att

# bar chart attrition count 

ggplot(data = jr_emp_att,aes(x= reorder(JobRole,attrition_count), y = attrition_count, fill = JobRole)) + 
  geom_col(position = "dodge") +
  coord_flip()+
  labs(title = "Attrition count Job Role wise", x = "Job R0le" , y = "Attrition Count")+
  geom_text(aes(label = attrition_count, hjust= -0.2))

# Pie Chart attrition rate

jr_emp_att_pie = jr_emp_att

jr_emp_att_pie = jr_emp_att_pie %>% 
  arrange(-prop_of_att) %>% 
  mutate(prop = attrition_count/sum(attrition_count)) %>% 
  mutate(ypos = cumsum(prop) -0.5 * prop)

jr_emp_att_pie

ggplot(data = jr_emp_att_pie,aes(x="" , y = prop, fill = JobRole)) +
  geom_bar(stat = "identity" , width = 1)+
  coord_polar("y" , start = 0) +
  labs(title = "JobRole wise Proportion of Attrition")+
  theme_void()+
  geom_text(aes(y = ypos  , label = percent(prop,accuracy = 0.01)), color = "Black",size = 3) 

  


```



